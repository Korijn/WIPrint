define(["TFS/WorkItemTracking/RestClient","TFS/WorkItemTracking/Contracts","moment","q"],function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(t,n){t.exports=e},function(e,t,n){var r,i;r=[n,t,n(0),n(2),n(3),n(4)],void 0===(i=function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=VSS.getExtensionContext(),c=VSS.getWebContext(),s=n.getClient(),u=[{name:"Assigned To",referenceName:"System.AssignedTo"},{name:"State",referenceName:"System.State"},{name:"Created Date",referenceName:"System.CreatedDate"},{name:"Description",referenceName:"System.Description"},{name:"Acceptance Criteria",referenceName:"Microsoft.VSTS.Common.AcceptanceCriteria"},{name:"History",referenceName:"System.History"}],m="L LT";String.prototype.sanitize=function(){return this.replace(/\s/g,"-").replace(/[^a-z0-9\-]/gi,"")},String.prototype.htmlize=function(){return this.replace(/<\/*(step|param|desc|comp)(.*?)>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")};var f={getMenuItems:function(e){var t="Print";return e.workItemIds&&e.workItemIds.length>1&&(t="Print Selection"),[{action:function(e){return l(e.workItemIds||e.ids||[e.workItemId||e.id]).then(function(e){return p(e)}).then(function(e){return o.all(e)}).then(function(e){var t=document.createElement("div");t.setAttribute("id","workitems"),e.forEach(function(e){return t.innerHTML+=e}),document.body.appendChild(t),setTimeout(function(){window.focus(),document.execCommand("print",!1,null)||window.print(),t.parentElement.removeChild(t)},1e3)})},icon:"static/img/print14.png",text:t,title:t}]}},d={getMenuItems:function(e){return[{action:function(e){return s.queryByWiql({query:e.query.wiql},c.project.name,c.team.name).then(function(e){return e.workItemRelations?e.workItemRelations.map(function(e){return e.target.id}):e.workItems.map(function(e){return e.id})}).then(function(e){return l(e).then(function(e){return p(e)}).then(function(e){return o.all(e)}).then(function(e){var t=document.createElement("div");t.setAttribute("id","workitems"),e.forEach(function(e){return t.innerHTML+=e}),document.body.appendChild(t),setTimeout(function(){window.focus(),document.execCommand("print",!1,null)||window.print(),t.parentElement.removeChild(t)},1e3)})})},icon:"static/img/print16.png",text:"Print All",title:"Print All"}]}};function l(e){return s.getWorkItems(e,void 0,void 0,r.WorkItemExpand.Links)}function p(e){return e.map(function(e){return o.all([function(e){return VSS.getService(VSS.ServiceIds.ExtensionData).then(function(t){return t.getValue("wiprint-"+e.fields["System.WorkItemType"].sanitize(),{scopeType:"user",defaultValue:u})})}(e),function(e){return s.getComments(e.id)}(e),s.getFields()]).then(function(e){return e}).spread(function(t,n,o){var a='<div class="item"><h2><a class="wilink" href="'+e._links.html.href+'">'+e.fields["System.WorkItemType"]+" "+e.id+" - "+e.fields["System.Title"]+"</a></h2>";return t.forEach(function(t){var c=o.filter(function(e){return e.referenceName===t.referenceName})[0];if(e.fields[t.referenceName])if(c.type)switch(c.type){case r.FieldType.DateTime:i(e.fields[t.referenceName]).diff(i(),"years")<1e3&&(a+="<p><b>"+t.name+":</b> "+i(e.fields[t.referenceName]).format(m)+"</p>");break;case r.FieldType.Html:a+="<p><b>"+t.name+":</b> "+e.fields[t.referenceName].htmlize()+"</p>";break;case r.FieldType.History:n.count>0&&(a+="<p><b>"+t.name+"</b></p>",n.comments.forEach(function(e){e.revisedBy.name?a+='<div class="history"><b>'+i(e.revisedDate).format(m)+" "+e.revisedBy.name.substring(0,e.revisedBy.name.indexOf("<")-1)+":</b><br> "+e.text.htmlize()+"</div>":a+='<div class="history"><b>'+i(e.revisedDate).format(m)+" "+e.revisedBy.displayName+":</b><br> "+e.text.htmlize()+"</div>"}));break;default:a+="<p><b>"+t.name+":</b> "+e.fields[t.referenceName]+"</p>"}else a+="<p><b>"+t.name+":</b> "+e.fields[t.referenceName]+"</p>";else"System.History"===t.referenceName&&n.count>0&&(a+="<p><b>"+t.name+"</b></p>",n.comments.forEach(function(e){e.revisedBy.name?a+='<div class="history"><b>'+i(e.revisedDate).format(m)+" "+e.revisedBy.name.substring(0,e.revisedBy.name.indexOf("<")-1)+":</b><br> "+e.text.htmlize()+"</div>":a+='<div class="history"><b>'+i(e.revisedDate).format(m)+" "+e.revisedBy.displayName+":</b><br> "+e.text.htmlize()+"</div>"}))}),a+="</div>"})})}VSS.register(a.publisherId+"."+a.extensionId+".print-work-item",f),VSS.register(a.publisherId+"."+a.extensionId+".print-query-toolbar",d),VSS.register(a.publisherId+"."+a.extensionId+".print-query-menu",d)}.apply(t,r))||(e.exports=i)},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r}])});
//# sourceMappingURL=wiprint.js.map